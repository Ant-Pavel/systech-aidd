<!-- a6b74fac-45c2-4983-a2e1-db6fb712a250 be2703de-c8b3-4dae-97ff-3345a07d2645 -->
# –ü–ª–∞–Ω Sprint D1: Build & Publish

## –¶–µ–ª—å

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è Docker –æ–±—Ä–∞–∑–æ–≤ –≤ GitHub Container Registry (ghcr.io) –ø—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

- –í Sprint D0 —Å–æ–∑–¥–∞–Ω—ã Dockerfile –¥–ª—è bot, api, frontend, postgres
- –û–±—Ä–∞–∑—ã —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ `docker-compose build`
- –¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–ª—è–µ–º CI/CD –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–±–æ—Ä–∫–∏ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

- –°–æ–∑–¥–∞—Ç—å `.github/workflows/build.yml` - GitHub Actions workflow
- –°–æ–∑–¥–∞—Ç—å `docker-compose.prod.yml` - –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤ –∏–∑ registry
- –°–æ–∑–¥–∞—Ç—å `devops/doc/github-actions-intro.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ GitHub Actions
- –û–±–Ω–æ–≤–∏—Ç—å `README.md` - –¥–æ–±–∞–≤–∏—Ç—å badges –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- –û–±–Ω–æ–≤–∏—Ç—å `Makefile` - –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å prod-–æ–±—Ä–∞–∑–∞–º–∏
- –°–æ–∑–¥–∞—Ç—å `devops/doc/guides/ghcr-setup.md` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ GHCR

## –®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è GitHub Actions (intro)

**–§–∞–π–ª:** `devops/doc/github-actions-intro.md`

–°–æ–∑–¥–∞—Ç—å –∫—Ä–∞—Ç–∫—É—é –≤–≤–æ–¥–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:

- –ß—Ç–æ —Ç–∞–∫–æ–µ GitHub Actions –∏ workflow
- –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç triggers (on: push, pull_request, workflow_dispatch)
- –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã —Å Pull Request
- Matrix strategy –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–∏
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ GitHub Container Registry (public/private)
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è secrets

### 2. GitHub Actions Workflow

**–§–∞–π–ª:** `.github/workflows/build.yml`

–°–æ–∑–¥–∞—Ç—å workflow —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏:

- **Trigger:** `on: push` –¥–ª—è –≤—Å–µ—Ö –≤–µ—Ç–æ–∫
- **Matrix strategy:** –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ 4 –æ–±—Ä–∞–∑–æ–≤ (bot, api, frontend, postgres)
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** Docker layer cache –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
- **–¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
  - `latest` - —Ç–æ–ª—å–∫–æ –¥–ª—è main –≤–µ—Ç–∫–∏
  - `sha-<commit>` - –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–º–∏—Ç–æ–≤
  - `branch-<name>` - –∏–º—è –≤–µ—Ç–∫–∏
- **–ü—É–±–ª–∏–∫–∞—Ü–∏—è:** –≤ ghcr.io —Å public –¥–æ—Å—Ç—É–ø–æ–º
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** —á–µ—Ä–µ–∑ `GITHUB_TOKEN` (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π)

–§–æ—Ä–º–∞—Ç –æ–±—Ä–∞–∑–æ–≤: `ghcr.io/OWNER/systech-aidd-bot:latest`

### 3. Docker Compose –¥–ª—è Production

**–§–∞–π–ª:** `docker-compose.prod.yml`

–°–æ–∑–¥–∞—Ç—å –≤–µ—Ä—Å–∏—é docker-compose –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤ –∏–∑ registry:

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `image:` –≤–º–µ—Å—Ç–æ `build:`
- –û–±—Ä–∞–∑—ã –∏–∑ `ghcr.io/OWNER/systech-aidd-{bot,api,frontend,postgres}:latest`
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ environment, ports, networks –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ docker-compose.yml
- –í—Å–µ 4 —Å–µ—Ä–≤–∏—Å–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–±—Ä–∞–∑—ã –∏–∑ registry

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Makefile

**–§–∞–π–ª:** `Makefile`

–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å prod-–æ–±—Ä–∞–∑–∞–º–∏:

```makefile
docker-pull:        # Pull –æ–±—Ä–∞–∑–æ–≤ –∏–∑ registry
docker-up-prod:     # –ó–∞–ø—É—Å–∫ —Å prod –æ–±—Ä–∞–∑–∞–º–∏ (docker-compose -f docker-compose.prod.yml up -d)
docker-build-prod:  # Pull + up –≤ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ
```

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è GHCR Setup

**–§–∞–π–ª:** `devops/doc/guides/ghcr-setup.md`

–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ GITHUB_TOKEN
- –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –æ–±—Ä–∞–∑—ã –ø—É–±–ª–∏—á–Ω—ã–º–∏ (—á–µ—Ä–µ–∑ GitHub Package Settings)
- –ö–∞–∫ –ª–æ–∫–∞–ª—å–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è pull –æ–±—Ä–∞–∑–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è public)
- –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±—Ä–∞–∑–∞–º–∏
- Troubleshooting

### 6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ README

**–§–∞–π–ª:** `README.md`

–î–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ:

- **Badge:** Build status –∏–∑ GitHub Actions
- **–°–µ–∫—Ü–∏—è:** "Docker Images" —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ ghcr.io
- **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã –∏–∑ registry

–î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è prod-–æ–±—Ä–∞–∑–æ–≤:

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤—ã—Ö –æ–±—Ä–∞–∑–æ–≤ –∏–∑ GitHub Container Registry
docker-compose -f docker-compose.prod.yml up -d
# –∏–ª–∏
make docker-up-prod
```

### 7. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å –æ–±—Ä–∞–∑–∞–º–∏

**–§–∞–π–ª:** `devops/doc/guides/using-registry-images.md`

–°–æ–∑–¥–∞—Ç—å —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ:

- –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞: –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å local build vs registry images
- –ö–æ–º–∞–Ω–¥—ã –¥–ª—è pull –æ–±—Ä–∞–∑–æ–≤
- –ö–∞–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏
- –ü–ª–∞–Ω—ã –Ω–∞ D2 (—Ä—É—á–Ω–æ–π deploy) –∏ D3 (–∞–≤—Ç–æ deploy)
- –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥

### 8. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ DevOps Roadmap

**–§–∞–π–ª:** `devops/doc/devops-roadmap.md`

–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–ø—Ä–∏–Ω—Ç–∞ D1:

- –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å "üìã Planned" –Ω–∞ "‚úÖ Done"
- –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ workflow:**

   - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –≤–µ—Ç–∫—É
   - –°–¥–µ–ª–∞—Ç—å push
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—É—Å–∫ workflow –≤ GitHub Actions

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:**

   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –æ–±—Ä–∞–∑—ã –ø–æ—è–≤–∏–ª–∏—Å—å –≤ ghcr.io
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ pull –∏ –∑–∞–ø—É—Å–∫–∞:**

   - –õ–æ–∫–∞–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å `make docker-pull`
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ `make docker-up-prod`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è MVP

- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–º–∏–Ω–∏–º—É–º —Ä—É—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ –Ω–∞ –∫–∞–∂–¥—ã–π push
- ‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ ghcr.io
- ‚úÖ Public –¥–æ—Å—Ç—É–ø –∫ –æ–±—Ä–∞–∑–∞–º
- ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ D2/D3 (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)

## –ù–µ –≤–∫–ª—é—á–∞–µ–º (–ø–æ–∫–∞)

- ‚ùå Lint checks –≤ CI
- ‚ùå Tests –≤ CI
- ‚ùå Security scanning
- ‚ùå Multi-platform builds (arm64/amd64)
- ‚ùå Deployment stages (staging/production)

## –î–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è

1. `.github/workflows/build.yml` - –æ—Å–Ω–æ–≤–Ω–æ–π workflow
2. `docker-compose.prod.yml` - production compose
3. `devops/doc/github-actions-intro.md` - –≤–≤–æ–¥–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
4. `devops/doc/guides/ghcr-setup.md` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ GHCR
5. `devops/doc/guides/using-registry-images.md` - —Ä–∞–±–æ—Ç–∞ —Å –æ–±—Ä–∞–∑–∞–º–∏
6. `devops/SPRINT_D1_COMPLETE.md` - –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç –æ —Å–ø—Ä–∏–Ω—Ç–µ

## –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ

1. `README.md` - badges, —Å–µ–∫—Ü–∏—è Docker Images
2. `Makefile` - –∫–æ–º–∞–Ω–¥—ã –¥–ª—è prod-–æ–±—Ä–∞–∑–æ–≤
3. `devops/doc/devops-roadmap.md` - —Å—Ç–∞—Ç—É—Å D1

### To-dos

- [ ] –°–æ–∑–¥–∞—Ç—å devops/doc/github-actions-intro.md —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π –ø–æ GitHub Actions
- [ ] –°–æ–∑–¥–∞—Ç—å .github/workflows/build.yml —Å matrix strategy –¥–ª—è 4 –æ–±—Ä–∞–∑–æ–≤ (bot, api, frontend, postgres)
- [ ] –°–æ–∑–¥–∞—Ç—å docker-compose.prod.yml –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤ –∏–∑ ghcr.io
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –≤ Makefile –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å prod-–æ–±—Ä–∞–∑–∞–º–∏
- [ ] –°–æ–∑–¥–∞—Ç—å devops/doc/guides/ghcr-setup.md —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –ø–æ GHCR
- [ ] –°–æ–∑–¥–∞—Ç—å devops/doc/guides/using-registry-images.md —Å —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º –ø–æ —Ä–∞–±–æ—Ç–µ —Å –æ–±—Ä–∞–∑–∞–º–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å README.md - –¥–æ–±–∞–≤–∏—Ç—å badges –∏ —Å–µ–∫—Ü–∏—é Docker Images
- [ ] –û–±–Ω–æ–≤–∏—Ç—å devops/doc/devops-roadmap.md - —Å—Ç–∞—Ç—É—Å D1 –Ω–∞ Done
- [ ] –°–æ–∑–¥–∞—Ç—å devops/SPRINT_D1_COMPLETE.md —Å –æ—Ç—á–µ—Ç–æ–º –æ —Å–ø—Ä–∏–Ω—Ç–µ

