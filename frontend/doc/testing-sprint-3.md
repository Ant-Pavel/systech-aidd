# Руководство по тестированию Sprint 3 Dashboard

## Предварительные требования

1. **Backend API запущен**
   ```bash
   python api_main.py
   ```
   Должно появиться:
   ```
   INFO: Starting Dashboard API server...
   INFO: Using MockStatCollector for statistics
   INFO: API documentation available at: http://localhost:8000/docs
   INFO: Uvicorn running on http://0.0.0.0:8000
   ```

2. **Frontend запущен**
   ```bash
   cd frontend
   pnpm run dev
   ```
   Должно появиться:
   ```
   ▲ Next.js 15.5.6
   - Local:        http://localhost:3000
   ✓ Ready in 2.5s
   ```

## Тестовые сценарии

### 1. Редирект с главной страницы

**Шаги:**
1. Откройте http://localhost:3000
2. Вы должны увидеть loading spinner
3. Автоматически редиректит на http://localhost:3000/dashboard

**Ожидаемый результат:**
- ✅ Редирект происходит мгновенно
- ✅ URL меняется на `/dashboard`
- ✅ Loading spinner отображается корректно

### 2. Загрузка Dashboard

**Шаги:**
1. Откройте http://localhost:3000/dashboard
2. Наблюдайте процесс загрузки

**Ожидаемый результат:**
- ✅ Показывается loading spinner "Загрузка данных..."
- ✅ После загрузки отображаются 3 метрические карточки
- ✅ График отображается под карточками
- ✅ Заголовок "Dashboard статистики диалогов" виден
- ✅ Period selector с 3 кнопками виден

### 3. Метрические карточки

**Проверяем каждую карточку:**

#### Total Messages
- ✅ Заголовок "Total Messages"
- ✅ Числовое значение (например: 12,543)
- ✅ Badge с процентом изменения (например: +12.5%)
- ✅ Иконка тренда (↑ зеленая, ↓ красная, − серая)
- ✅ Описание тренда (например: "Trending up this month")

#### Active Conversations
- ✅ Заголовок "Active Conversations"
- ✅ Числовое значение
- ✅ Badge с процентом изменения
- ✅ Иконка тренда
- ✅ Описание тренда

#### Avg Conversation Length
- ✅ Заголовок "Avg Conversation Length"
- ✅ Числовое значение с 1 знаком после запятой (например: 8.7)
- ✅ Badge с процентом изменения
- ✅ Иконка тренда
- ✅ Описание тренда

### 4. График временного ряда

**Проверяем:**
- ✅ Заголовок "Messages Over Time"
- ✅ Описание "Динамика количества сообщений за выбранный период"
- ✅ Линейный график отображается
- ✅ Ось X показывает даты (формат: Mon DD)
- ✅ Ось Y показывает количество сообщений
- ✅ Линия синего/primary цвета
- ✅ При наведении показывается Tooltip с данными
- ✅ График адаптивный (занимает всю ширину)

### 5. Period Selector

**Шаги:**
1. Проверьте, что "Last 7 days" активна по умолчанию (secondary variant)
2. Нажмите "Last 30 days"
3. Нажмите "Last 3 months"
4. Вернитесь на "Last 7 days"

**Ожидаемый результат:**
- ✅ Активная кнопка визуально выделена (secondary variant)
- ✅ При клике показывается loading
- ✅ Метрики обновляются с новыми данными
- ✅ График обновляется с новым количеством точек
  - 7d: ~7 точек
  - 30d: ~30 точек
  - 3m: ~12-13 точек (по неделям)

### 6. Responsive дизайн

**Шаги:**
1. Откройте DevTools (F12)
2. Переключайтесь между размерами экрана

**Проверяем:**

#### Desktop (> 768px)
- ✅ 3 метрические карточки в ряд (grid-cols-3)
- ✅ Header с заголовком слева и period selector справа
- ✅ График занимает всю ширину

#### Tablet (768px)
- ✅ 3 метрические карточки в ряд
- ✅ Header становится колонкой (flex-col)
- ✅ График адаптируется

#### Mobile (< 768px)
- ✅ Метрические карточки стопкой (1 колонка)
- ✅ Header в колонку
- ✅ Period selector кнопки уменьшены (size="sm")
- ✅ График остается читаемым

### 7. Dark Mode

**Шаги:**
1. Откройте дашборд
2. Переключите системную тему на Dark (или используйте DevTools)

**Ожидаемый результат:**
- ✅ Фон меняется на темный
- ✅ Карточки темные с светлой границей
- ✅ Текст светлый на темном фоне
- ✅ График использует светлые цвета линий и сетки
- ✅ Badges корректно отображаются
- ✅ Хороший контраст между элементами

### 8. Обработка ошибок

**Тест 1: API не запущен**
1. Остановите `python api_main.py`
2. Обновите страницу дашборда

**Ожидаемый результат:**
- ✅ Показывается красный блок с ошибкой
- ✅ Текст: "Ошибка: Failed to fetch stats: ..."
- ✅ Подсказка: "Убедитесь, что backend запущен (python api_main.py)"

**Тест 2: Неверный период**
1. Вручную откройте http://localhost:8000/api/stats?period=invalid
2. Должна быть ошибка 400

### 9. TypeScript и Linting

**Проверяем в терминале:**

```bash
cd frontend

# TypeScript проверка
pnpm run build

# ESLint
pnpm run lint
```

**Ожидаемый результат:**
- ✅ `pnpm run build` - успешная сборка без ошибок
- ✅ `pnpm run lint` - нет ошибок и предупреждений
- ✅ TypeScript strict mode - 0 ошибок

### 10. Производительность

**Проверяем в DevTools:**

1. Откройте Network tab
2. Обновите страницу
3. Проверьте Lighthouse (Performance tab)

**Метрики:**
- ✅ Initial load < 2s
- ✅ API call `/api/stats?period=7d` < 500ms
- ✅ No memory leaks при переключении периодов
- ✅ Re-render только при изменении данных

### 11. Интеграция с Mock API

**Проверяем формат данных:**

1. Откройте http://localhost:8000/docs (Swagger UI)
2. Попробуйте endpoint `/api/stats` с разными периодами
3. Проверьте ответ

**Ожидаемая структура:**
```json
{
  "metrics": {
    "total_messages": {
      "value": number,
      "change_percent": number,
      "trend": "up" | "down" | "stable",
      "description": string
    },
    "active_conversations": { ... },
    "avg_conversation_length": { ... }
  },
  "time_series": [
    {"date": "YYYY-MM-DD", "value": number}
  ]
}
```

### 12. Accessibility (a11y)

**Проверяем:**
- ✅ Semantic HTML (main, header, section)
- ✅ Правильная иерархия заголовков (h1, h2)
- ✅ Кнопки доступны с клавиатуры (Tab navigation)
- ✅ Focus states видны
- ✅ Цветовой контраст достаточный (WCAG AA)
- ✅ Screen reader friendly (через shadcn/ui components)

**Тест с клавиатурой:**
1. Используйте только Tab/Shift+Tab для навигации
2. Enter/Space для активации кнопок
3. Все элементы должны быть доступны

## Чек-лист перед коммитом

- [ ] Все тесты выше пройдены
- [ ] `pnpm run build` успешен
- [ ] `pnpm run lint` без ошибок
- [ ] Responsive дизайн работает на всех размерах
- [ ] Dark mode корректен
- [ ] API интеграция работает
- [ ] Обработка ошибок реализована
- [ ] Performance удовлетворительный
- [ ] Accessibility требования соблюдены

## Известные ограничения

1. **Mock данные**: API возвращает сгенерированные данные, не реальные из БД
2. **Нет кеширования**: Каждое переключение периода делает новый запрос
3. **Нет offline режима**: Требуется работающий backend
4. **Нет анимаций**: Графики не анимируются при обновлении

## Следующие улучшения

- Добавить React Query для кеширования
- Добавить Skeleton loaders вместо spinner
- Добавить анимации графиков (Recharts animations)
- Добавить export в CSV/PNG
- Добавить фильтры (по пользователям, чатам)

